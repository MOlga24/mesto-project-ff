(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),p:""};e.d({},{PU:()=>O});var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-22",headers:{authorization:"3bdecd97-cc83-4e5e-ac8d-e22694049ffd","Content-Type":"application/json"}},n=function(e){if(e.ok)return e.json()};function o(){return fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then(n)}function r(e,o){return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:e,link:o})}).then(n)}function c(e){e.classList.add("popup_is-animated"),e.classList.contains("popup_type_image")||e.classList.contains("popup_delete_image")||(e.querySelector(".button").classList.add("popup__button_disabled"),e.querySelector(".button").textContent="Сохранить"),e.classList.add("popup_is-opened"),document.addEventListener("keydown",u)}function i(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}function u(e){"Escape"===e.key&&i(document.querySelector(".popup_is-opened"))}function a(e){e.currentTarget===e.target&&i(e.currentTarget)}var s=document.querySelector("#card-template").content;function l(e,n,o,r,i){var u=s.querySelector(".card__image");u.setAttribute("alt",e.name),u.setAttribute("src",e.link);var a=s.querySelector(".places__item").cloneNode(!0);a.querySelector(".card__title").textContent=e.name;var l=e._id,d=a.querySelector(".card__like-button");a.querySelector(".like__num").textContent=e.likes.length;var p=a.querySelector(".card__delete-button");return e.owner._id!==i&&p.remove(),p.addEventListener("click",(function(){c(O),document.forms.delete_card.addEventListener("submit",(function(){n(p,l)}))})),a.querySelector(".card__image").addEventListener("click",r),d.addEventListener("click",(function(){_(e,i),_(e,i)?(function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).catch((function(e){return console.log(e)}))}(e._id).then((function(e){return e.json()})).then((function(t){e.likes=t.likes,o(t.likes,d)})),d.classList.remove("card__like-button_is-active")):(function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers})}(e._id).then((function(e){return e.json()})).then((function(t){e.likes=t.likes,o(t.likes,d)})),d.classList.add("card__like-button_is-active"))})),a}function d(e,o){var r=e.closest(".card");!function(e){fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then(n).catch((function(e){return console.log(e)}))}(o),r.remove(),i(O)}function p(e,t){t.nextElementSibling.textContent=e.length}function _(e,t){if(Array.from(e.likes).map((function(e){return{_id:e._id}})).find((function(e){return e._id===t})))return!0}e.p;var f=".popup__form",m=".popup__input",y=".popup__button",h="popup__button_disabled",v="popup__input_type_error",S="popup__error_visible",b=".popup__error_visible";function q(){document.querySelectorAll(m).forEach((function(e){e.classList.remove(v)})),document.querySelectorAll(b).forEach((function(e){e.textContent="",e.classList.remove(S)}))}var g=function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(v),n.classList.remove(S),n.textContent=""}(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(v),o.textContent=n,o.classList.add(S)}(e,t,t.validationMessage)},L=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(h),t.disabled=!1):(t.classList.add(h),t.disabled=!0)},E=document.querySelector(".popup_type_new-card"),k=document.querySelector(".profile__add-button"),C=document.querySelector(".popup_type_edit"),x=document.querySelector(".places__list"),A=document.querySelectorAll(".popup"),U=document.querySelector(".profile__edit-button"),P=document.querySelector(".popup_type_image"),T=P.querySelector(".popup__image"),w=document.querySelector(".profile__info"),O=document.querySelector(".popup_delete_image"),j=document.querySelector(".profile__image"),D=document.querySelector(".popup_edit_image"),N=[o(),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then(n)];function J(){c(P);var e=P.querySelector(".popup__caption");T.src=this.src,e.textContent=this.alt}function M(e,o){w.querySelector(".profile__title").textContent=e,w.querySelector(".profile__description").textContent=o,function(e,o){fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e,about:o})}).then(n).catch((function(e){return console.log(e)}))}(e,o)}document.forms.edit_profile.addEventListener("submit",(function(e){this.querySelector(".button").textContent="Сохранение...",M(document.forms.edit_profile.elements.name.value,document.forms.edit_profile.elements.description.value),e.preventDefault(),i(C),document.forms.edit_profile.reset()})),document.forms.new_place.addEventListener("submit",(function(){this.querySelector(".button").textContent="Сохранение...";var e=E.querySelector(".popup__input_type_card-name").value,t=E.querySelector(".popup__input_type_url").value;event.preventDefault(),Promise.all([o(),r(e,t)]).then((function(e){x.prepend(l(e[1],d,p,J,e[0]._id))})).catch((function(e){console.error(e)})),i(E)})),document.addEventListener("click",(function(e){e.target===k&&(document.forms.new_place.reset(),q(),c(E)),e.target===U&&(q(),document.querySelector(".popup__input_type_name").value=w.querySelector(".profile__title").textContent,document.querySelector(".popup__input_type_description").value=w.querySelector(".profile__description").textContent,c(C)),e.target===j&&(document.forms.popup_edit_image.reset(),q(),c(D))})),document.forms.popup_edit_image.addEventListener("submit",(function(){var e;this.querySelector(".button").textContent="Сохранение...",e=document.querySelector(".ava_link").value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})}).then(n).then((function(t){e=t.avatar})).then(document.querySelector(".profile__image").setAttribute("style","background-image: url(".concat(e,")"))).catch((function(e){return console.log(e)})),i(D)})),A.forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){i(e)}))})),A.forEach((function(e){e.addEventListener("click",a)})),Promise.all(N).then((function(e){document.querySelector(".profile__image").setAttribute("style","background-image: url(".concat(e[0].avatar,")"));var t=e[0].name,n=e[0].about,o=e[0]._id;M(t,n),function(e,t){x.textContent=" ",e.forEach((function(e){x.append(l(e,d,p,J,t))}))}(Array.from(e[1]),o)})).catch((function(e){console.error(e)})),Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(e.querySelectorAll(f)).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(m)),n=e.querySelector(y);L(t,n),t.forEach((function(o){o.addEventListener("input",(function(){L(t,n),g(e,o)}))}))}(e)}))}))})();