(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),p:""};e.d({},{PU:()=>P,oS:()=>M,XX:()=>D});var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-22",headers:{authorization:"3bdecd97-cc83-4e5e-ac8d-e22694049ffd","Content-Type":"application/json"}},o=function(){return fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){if(e.ok)return e.json()})).then((function(e){console.log(e),D(Array.from(e))})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))}))};function n(e,t,n,i){o();var a=e.likes.length;if(0==a)r(n),t.nextElementSibling.textContent=a+1,t.classList.add("card__like-button_is-active");else{var u=Array.from(e.likes).map((function(e){return{_id:e._id}}));for(var d in u)u[d]._id==i?(c(n),t.classList.remove("card__like-button_is-active")):(r(n),t.classList.add("card__like-button_is-active"))}o()}function r(e){fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:"3bdecd97-cc83-4e5e-ac8d-e22694049ffd","Content-Type":"application/json"}}).then((function(e){return e.json()}))}function c(e){fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:"3bdecd97-cc83-4e5e-ac8d-e22694049ffd","Content-Type":"application/json"}}).then((function(e){return e.json()}))}function i(e){e.classList.add("popup_is-animated"),e.classList.add("popup_is-opened"),document.addEventListener("keydown",u)}function a(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}function u(e){"Escape"===e.key&&a(document.querySelector(".popup_is-opened"))}function d(e){e.currentTarget===e.target&&a(e.currentTarget)}var s=document.querySelector("#card-template").content;function l(e,o){!function(e,o){fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:{authorization:"3bdecd97-cc83-4e5e-ac8d-e22694049ffd","Content-Type":"application/json"}}).then((function(e){return e.json()})).catch((function(e){return console.log(e)})),o.remove()}(o,e.closest(".card"))}function p(e,t,o,n){var r=s.querySelector(".card__image");r.setAttribute("alt",e.name),r.setAttribute("src",e.link);var c=s.querySelector(".places__item").cloneNode(!0);c.querySelector(".card__title").textContent=e.name;var u="18224dc979a1237fbf3f98ed",d=e.likes.length,l=c.querySelector(".card__like-button");c.querySelector(".like__num").textContent=d,l.addEventListener("click",(function(){o(e,l,e._id,u)}));var p=c.querySelector(".card__delete-button");return e.hasOwnProperty("owner")&&e.owner._id!==u&&p.remove(),p.addEventListener("click",(function(){i(P),document.forms.delete_card.addEventListener("submit",(function(){a(P),t(p,e._id)}))})),c.querySelector(".card__image").addEventListener("click",n),c}e.p;var f=".popup__form",_=".popup__input",m=".popup__button",y="popup__button_disabled",v="popup__input_type_error",h="popup__error_visible",S=".popup__error_visible";function b(){document.querySelectorAll(_).forEach((function(e){e.classList.remove(v)})),document.querySelectorAll(S).forEach((function(e){e.textContent="",e.classList.remove(h)}))}var q=function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(v),o.classList.remove(h),o.textContent=""}(e,t):function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add(v),n.textContent=o,n.classList.add(h)}(e,t,t.validationMessage)},E=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(y),t.disabled=!1):(t.classList.add(y),t.disabled=!0)},L=document.querySelector(".popup_type_new-card"),g=document.querySelector(".profile__add-button"),k=document.querySelector(".popup_type_edit"),C=document.querySelector(".places__list"),x=document.querySelectorAll(".popup"),A=document.querySelector(".profile__edit-button"),j=document.querySelector(".popup_type_image"),w=j.querySelector(".popup__image"),T=document.querySelector(".profile__info"),P=document.querySelector(".popup_delete_image"),z=document.querySelector(".profile__image"),O=document.querySelector(".popup_edit_image");function U(){i(j);var e=j.querySelector(".popup__caption");w.src=this.src,e.textContent=this.alt}function D(e){C.textContent=" ",e.forEach((function(e){C.append(p(e,l,n,U))}))}function M(e,t){T.querySelector(".profile__title").textContent=e,T.querySelector(".profile__description").textContent=t,function(e,t){fetch("https://nomoreparties.co/v1/wff-cohort-22/users/me",{method:"PATCH",headers:{authorization:"3bdecd97-cc83-4e5e-ac8d-e22694049ffd","Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})})}(e,t)}document.forms.edit_profile.addEventListener("submit",(function(e){this.querySelector(".button").textContent="Сохранение...",M(document.forms.edit_profile.elements.name.value,document.forms.edit_profile.elements.description.value),e.preventDefault(),a(k)})),document.forms.new_place.addEventListener("submit",(function(e){this.querySelector(".button").textContent="Сохранение...";var t=L.querySelector(".popup__input_type_card-name").value,o=L.querySelector(".popup__input_type_url").value;e.preventDefault(),function(e,t){fetch("https://nomoreparties.co/v1/wff-cohort-22/cards",{method:"POST",headers:{authorization:"3bdecd97-cc83-4e5e-ac8d-e22694049ffd","Content-Type":"application/json"},body:JSON.stringify({name:e,link:t,likes:""})}).then((function(e){return e.json()}))}(t,o);var r=p({name:t,link:o,likes:""},l,n,U);C.prepend(r),a(L)})),document.addEventListener("click",(function(e){e.target===g&&(document.forms.new_place.reset(),b(),L.querySelector(".button").textContent="Сохранить",i(L)),e.target===A&&(b(),document.querySelector(".popup__input_type_name").value=T.querySelector(".profile__title").textContent,document.querySelector(".popup__input_type_description").value=T.querySelector(".profile__description").textContent,k.querySelector(".button").textContent="Сохранить",i(k))})),z.addEventListener("click",(function(){O.querySelector(".button").textContent="Сохранить",i(O)})),document.forms.popup_edit_image.addEventListener("submit",(function(){O.querySelector(".button").textContent="Сохранение...",a(O);var e=document.querySelector(".ava_link").value;document.querySelector(".profile__image").setAttribute("style","background-image: url(".concat(e,")"))})),x.forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){a(e)}))})),x.forEach((function(e){e.addEventListener("click",d)})),o(),fetch("https://nomoreparties.co/v1/wff-cohort-22/users/me",{headers:{authorization:"3bdecd97-cc83-4e5e-ac8d-e22694049ffd"}}).then((function(e){return e.json()})).then((function(e){document.querySelector(".profile__image").setAttribute("style","background-image: url(".concat(e.avatar,")")),M(e.name,e.about)})),Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(e.querySelectorAll(f)).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(_)),o=e.querySelector(m);E(t,o),t.forEach((function(n){n.addEventListener("input",(function(){E(t,o),q(e,n)}))}))}(e)}))}))})();